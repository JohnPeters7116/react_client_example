(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),c=n.n(a),s=n(46),o=n.n(s),i=(n(53),n(5)),u=n(4),l=n(2),d=n.n(l),b=n(3),p=n(6),j=n(14),f=n.n(j),m=n(12);var v=function(e){var t=e.onSubmit,n=Object(m.a)(),a=n.register,c=n.handleSubmit,s=n.errors;return Object(r.jsxs)("form",{onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"conversation_name",children:"Name"}),Object(r.jsx)("input",{type:"text",id:"conversation_name",name:"conversation_name","aria-invalid":s.name?"true":"false",ref:a({required:!0,maxLength:30})}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{htmlFor:"conversation_display_name",children:"Display Name"}),Object(r.jsx)("input",{type:"text",id:"conversation_display_name",name:"conversation_display_name","aria-invalid":s.name?"true":"false",ref:a({required:!0,maxLength:30})}),s.name&&"required"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),s.name&&"maxLength"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("input",{type:"submit"})]})};var h=function(e){var t=e.onSubmit,n=Object(m.a)(),a=n.register,c=n.handleSubmit,s=n.errors;return Object(r.jsxs)("form",{onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"audio_conversation_id",children:"Conversations Id "}),Object(r.jsx)("input",{type:"text",id:"audio_conversation_id",name:"audio_conversation_id","aria-invalid":s.name?"true":"false",defaultValue:"CON-71ed48a1-4983-4557-a911-561fcb380d2f",ref:a({required:!0,maxLength:50})}),s.name&&"required"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),s.name&&"maxLength"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("input",{type:"submit"})]})};var O=function(e){var t=e.onSubmit,n=Object(m.a)(),a=n.register,c=n.handleSubmit,s=n.errors;return Object(r.jsxs)("form",{onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"username",children:"User Name"}),Object(r.jsx)("input",{type:"text",id:"username",name:"username","aria-invalid":s.name?"true":"false",ref:a({required:!0,maxLength:30})}),s.name&&"required"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),s.name&&"maxLength"===s.name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("input",{type:"submit"})]})},x=n(47);var g=function(e){var t=e.srcObject,n=Object(x.a)(e,["srcObject"]),c=Object(a.useRef)(null);return Object(a.useEffect)((function(){c.current&&(c.current.srcObject=t)}),[t]),Object(r.jsx)("audio",Object(i.a)(Object(i.a)({ref:c},n),{},{controls:!0,autoPlay:!0}))},y=function(e){var t=e.event,n=e.style,a="unknown";return t.request&&t.response?a="<- http response":t.request&&!t.response?a="-> http request":t.type&&t.body&&(a="<- ws event"),Object(r.jsx)("h3",{style:n,children:a})},S=function(e){var t=e.eventsHistory,n=e.onCleanHistoryClick;return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"History"}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:n,children:"Clean History"})}),t.map((function(e,t){return Object(r.jsxs)("div",{children:[Object(r.jsx)(y,{event:e,style:{padding:"5px",margin:"5px"}}),Object(r.jsx)("pre",{style:{padding:"5px",margin:"5px",backgroundColor:"#ddd"},children:JSON.stringify(e," "," ")})]},t)}))]})},C=function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.onicegatheringstatechange=function(){console.log("onicegatheringstatechange ",t.iceGatheringState),"complete"===t.iceGatheringState&&e()}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var _=function(){var e=Object(b.a)(d.a.mark((function e(){var t,n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 2:return t=e.sent,(n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]})).addStream(t),e.next=7,n.createOffer();case 7:return r=e.sent,n.setLocalDescription(r),e.next=11,C(n);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=n(71);function k(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}var q=function(){var e;(e=console).log.apply(e,arguments)},E=function(){var e;(e=console).error.apply(e,arguments)};n(103);var D=function(){var e={},t=[],r=[],a=[],c=function(){var t=Object(b.a)(d.a.mark((function t(n){var c,s,o,u,l,b;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=(c=e).token,o=c.session_id,u=c.cs_url,t.prev=1,n.headers={Authorization:"Bearer ".concat(s)},n.url="".concat(u).concat(n.url),n.data&&(n.data=Object(i.a)({originating_session:o},n.data)),q({request:n},"CSClient request -> "),r.forEach((function(e){return(0,e.callback)({request:n})})),t.next=9,f()(n);case 9:return l=t.sent,a.forEach((function(e){return(0,e.callback)({request:n,response:{data:l.data,status:l.status,headers:l.headers}})})),q({request:n,data:l.data,status:l.status},"CSClient reponse <-"),t.abrupt("return",l);case 15:throw t.prev=15,t.t0=t.catch(1),b={request:n},t.t0.response&&(b.response={data:t.t0.response.data,status:t.t0.response.status,headers:t.t0.response.headers}),t.t0.message&&(b.message=t.t0.message),E(Object(i.a)({},b),"CSClient error <-"),a.forEach((function(e){return(0,e.callback)(b)})),t.t0;case 23:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}();return{connect:function(){var r=Object(b.a)(d.a.mark((function r(a){var c,s,o;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=a.token,s=a.cs_url,o=a.ws_url,r.abrupt("return",new Promise((function(r){var a=w.connect(o,{path:"/rtc",transports:["websocket"],forceNew:!1,reconnection:!1,autoConnect:!0});n(101)(w.Manager)(a),a.on("connect",(function(){a.on("*",(function(e){var n=Object(p.a)(e.data,2),r=n[0],a=n[1],c=Object(i.a)({type:r},a);t.forEach((function(e){return(0,e.callback)(c)}))}));var n={device_id:"666666666666666",device_type:"js",token:c};a.emit("session:login",{body:n}),a.on("session:success",(function(t){var n=t.body,a=n.id,i=n.name,u=n.user_id;e={session_id:a,user_name:i,user_id:u,token:c,cs_url:s,ws_url:o},r()}))}))})));case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),request:c,getSessionData:function(){return e},onEvent:function(e){var n=k();return t.push({id:n,callback:e}),n},onRequestStart:function(e){var t=k();return r.push({id:t,callback:e}),t},onRequestEnd:function(e){var t=k();return a.push({id:t,callback:e}),t}}}(),L="http://localhost:5001";var P=function(e){var t=e.onSubmitLogin,n=e.onSubmitSubscribe;return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Login"}),Object(r.jsx)(O,{onSubmit:t}),Object(r.jsx)("h2",{children:"Or Subscribe"}),Object(r.jsx)(O,{onSubmit:n})]})};function A(e){var t=function(e){var t=Object(a.useState)(null),n=Object(p.a)(t,2),r=n[0],c=n[1],s=function(e){c(e)};return Object(a.useEffect)((function(){e.onEvent(s),e.onRequestStart(s),e.onRequestEnd(s)})),r}(D),n=Object(a.useState)([]),c=Object(p.a)(n,2),s=c[0],o=c[1],l=Object(a.useState)({audioSrcObject:null,peerConnection:null}),j=Object(p.a)(l,2),f=j[0],m=j[1];Object(a.useEffect)((function(){console.log(" ->->->-> useEffect init csClient"),function(){var t=Object(b.a)(d.a.mark((function t(){var n,r,a,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(" ++++ initialize createCSClient"),n=e.loginData,r=n.token,a=n.cs_url,c=n.ws_url,D.connect({token:r,cs_url:a,ws_url:c});case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[e.loginData]),Object(a.useEffect)((function(){var e;(e=t)&&o((function(t){return[].concat(Object(u.a)(t),[e])}))}),[t]),Object(a.useEffect)((function(){if(console.log(" ->->->-> useEffect csClient Handler ",D),D){var e=function(e){var t=f.peerConnection.getRemoteStreams()[0];console.log("_setAudioSrcObject ",t),m((function(e){return console.log("setAudioState onTrack",Object(i.a)(Object(i.a)({},e),{},{audioSrcObject:t})),Object(i.a)(Object(i.a)({},e),{},{audioSrcObject:t})}))},t=function(){var t=Object(b.a)(d.a.mark((function t(n){var r,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"rtc:answer"===n.type&&(r=n.body.answer,a=new RTCSessionDescription({type:"answer",sdp:r}),console.log("rtc:answer audioState ",f),f.peerConnection&&(f.peerConnection.ontrack=e,f.peerConnection.setRemoteDescription(a)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();D.onEvent(t)}}),[f]);var O=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,r,a,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("--- onEnableAudioInConversationSubmit",t),n=t.audio_conversation_id,r=n,e.next=6,_();case 6:return a=e.sent,console.log("setAudioState ",Object(i.a)(Object(i.a)({},f),{},{peerConnection:a})),m(Object(i.a)(Object(i.a)({},f),{},{peerConnection:a})),e.next=11,D.request({url:"/v0.3/users/".concat(D.getSessionData().user_id,"/conversations"),method:"get"});case 11:return c=e.sent,s=c.data._embedded.conversations.find((function(e){return e.id===r}))._embedded.member.id,e.next=15,D.request({url:"/v0.1/conversations/".concat(r,"/rtc"),method:"post",data:{from:s,body:{offer:a.localDescription}}});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log("onEnableAudioInConversationSubmit error: ",e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.conversation_name,r=t.conversation_display_name,e.next=3,D.request({url:"/v0.3/conversations",method:"post",data:{name:n,display_name:r}});case 3:return a=e.sent,e.next=6,D.request({url:"/v0.3/conversations/".concat(a.data.id,"/members"),method:"post",data:{state:"joined",user:{name:D.getSessionData().user_name},channel:{type:"app"}}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.request({url:"/v0.3/users/".concat(D.getSessionData().user_id,"/conversations"),method:"get"});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"Conversations Client Playground"}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Create Conversation and Join"}),Object(r.jsx)(v,{onSubmit:x}),Object(r.jsx)("h2",{children:"Get My Conversations"}),Object(r.jsx)("button",{onClick:y,children:"Get My Conversations"}),Object(r.jsx)("h2",{children:"Enable Audio In Conversations"}),Object(r.jsx)(h,{onSubmit:O}),Object(r.jsx)(g,{srcObject:f.audioSrcObject}),Object(r.jsx)(S,{eventsHistory:s,onCleanHistoryClick:function(){return o((function(){return[]}))}})]})]})}var R=function(){var e=Object(a.useState)(null),t=Object(p.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(null),o=Object(p.a)(s,2),i=(o[0],o[1]),u=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,e.next=3,f()({url:"".concat(L,"/api/login"),method:"post",data:{username:n}});case 3:r=e.sent,i(r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,e.next=3,f()({url:"".concat(L,"/api/subscribe"),method:"post",data:{username:n}});case 3:r=e.sent,c(r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){document.title="Conversation Service examples"})),Object(r.jsxs)("div",{children:[!n&&Object(r.jsx)(P,{onSubmitLogin:u,onSubmitSubscribe:l}),n&&Object(r.jsx)(A,{loginData:n})]})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,105)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(R,{})}),document.getElementById("root")),M()},53:function(e,t,n){},98:function(e,t){}},[[104,1,2]]]);
//# sourceMappingURL=main.ac5eaef5.chunk.js.map
(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),c=n.n(a),o=n(46),s=n.n(o),i=(n(53),n(2)),u=n.n(i),l=n(3),d=n(5),b=n(14),j=n.n(b),p=n(9);var v=function(e){var t=e.onSubmit,n=Object(p.a)(),a=n.register,c=n.handleSubmit,o=n.errors;return Object(r.jsxs)("form",{onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"username",children:"User Name"}),Object(r.jsx)("input",{type:"text",id:"username",name:"username","aria-invalid":o.name?"true":"false",ref:a({required:!0,maxLength:30})}),o.name&&"required"===o.name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),o.name&&"maxLength"===o.name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("input",{type:"submit"})]})},f=n(6),m=n(4),h=n(71);function O(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}var x=function(){var e;(e=console).log.apply(e,arguments)},_=function(){var e;(e=console).error.apply(e,arguments)};var g=function(e){var t=e.onSubmit,n=Object(p.a)(),a=n.register,c=n.handleSubmit,o=n.errors;return Object(r.jsxs)("form",{name:"CreateConversation",id:"CreateConversation",onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"conversation_name",children:"Name"}),Object(r.jsx)("input",{type:"text",id:"conversation_name",name:"conversation_name","aria-invalid":o.conversation_name?"true":"false",ref:a({required:!0,maxLength:30})}),o.conversation_name&&"required"===o.conversation_name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),o.conversation_name&&"maxLength"===o.conversation_name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("br",{}),Object(r.jsx)("label",{htmlFor:"conversation_display_name",children:"Display Name"}),Object(r.jsx)("input",{type:"text",id:"conversation_display_name",name:"conversation_display_name","aria-invalid":o.conversation_display_name?"true":"false",ref:a({required:!0,maxLength:30})}),o.conversation_display_name&&"required"===o.conversation_display_name.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),o.conversation_display_name&&"maxLength"===o.conversation_display_name.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"submit"})]})};var y=function(e){var t=e.onSubmit,n=Object(p.a)(),a=n.register,c=n.handleSubmit,o=n.errors;return Object(r.jsxs)("form",{name:"joinConversation",id:"joinConversation",onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"conversation_join_id",children:"Conversation ID:"}),Object(r.jsx)("input",{type:"text",id:"conversation_join_id",name:"conversation_join_id","aria-invalid":o.conversation_join_id?"true":"false",ref:a({required:!0,maxLength:40})}),o.conversation_join_id&&"required"===o.conversation_join_id.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"submit",value:"Join Conversation"})]})};var S=function(e){var t=e.onSubmit,n=Object(p.a)(),a=n.register,c=n.handleSubmit,o=n.errors;return Object(r.jsxs)("form",{onSubmit:c(t),children:[Object(r.jsx)("label",{htmlFor:"audio_conversation_id",children:"Conversations Id "}),Object(r.jsx)("input",{type:"text",id:"audio_conversation_id",name:"audio_conversation_id","aria-invalid":o.name?"true":"false",defaultValue:"CON-71ed48a1-4983-4557-a911-561fcb380d2f",ref:a({required:!0,maxLength:40})}),o.audio_conversation_id&&"required"===o.audio_conversation_id.type&&Object(r.jsx)("span",{role:"alert",children:"This is required"}),o.audio_conversation_id&&"maxLength"===o.audio_conversation_id.type&&Object(r.jsx)("span",{role:"alert",children:"Max length exceeded"}),Object(r.jsx)("input",{type:"submit"})]})},C=n(47);var w=function(e){var t=e.srcObject,n=Object(C.a)(e,["srcObject"]),c=Object(a.useRef)(null);return Object(a.useEffect)((function(){c.current&&(c.current.srcObject=t)}),[t]),Object(r.jsx)("audio",Object(f.a)(Object(f.a)({ref:c},n),{},{controls:!0,autoPlay:!0}))},k=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.onicegatheringstatechange=function(){console.log("onicegatheringstatechange ",t.iceGatheringState),"complete"===t.iceGatheringState&&e()}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var q=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 2:return t=e.sent,(n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]})).addStream(t),e.next=7,n.createOffer();case 7:return r=e.sent,n.setLocalDescription(r),e.next=11,k(n);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(e){var t=e.event,n=e.style,a="unknown";return t.request&&t.response?a="<- http response":t.request&&!t.response?a="-> http request":t.type&&t.body&&(a="<- ws event"),Object(r.jsx)("h3",{style:n,children:a})},D=function(e){var t=e.eventsHistory,n=e.onCleanHistoryClick;return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"History"}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:n,children:"Clean History"})}),t.map((function(e,t){return Object(r.jsxs)("div",{children:[Object(r.jsx)(E,{event:e,style:{padding:"5px",margin:"5px"}}),Object(r.jsx)("pre",{style:{padding:"5px",margin:"5px",backgroundColor:"#ddd"},children:JSON.stringify(e," "," ")})]},t)}))]})},L=function(){var e={},t=[],r=[],a=[],c=function(){var t=Object(l.a)(u.a.mark((function t(n){var c,o,s,i,l,d;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=(c=e).token,s=c.session_id,i=c.cs_url,t.prev=1,n.headers={Authorization:"Bearer ".concat(o)},n.url="".concat(i).concat(n.url),n.data&&(n.data=Object(f.a)({originating_session:s},n.data)),x({request:n},"CSClient request -> "),r.forEach((function(e){return(0,e.callback)({request:n})})),t.next=9,j()(n);case 9:return l=t.sent,a.forEach((function(e){return(0,e.callback)({request:n,response:{data:l.data,status:l.status,headers:l.headers}})})),x({request:n,data:l.data,status:l.status},"CSClient reponse <-"),t.abrupt("return",l);case 15:throw t.prev=15,t.t0=t.catch(1),d={request:n},t.t0.response&&(d.response={data:t.t0.response.data,status:t.t0.response.status,headers:t.t0.response.headers}),t.t0.message&&(d.message=t.t0.message),_(Object(f.a)({},d),"CSClient error <-"),a.forEach((function(e){return(0,e.callback)(d)})),t.t0;case 23:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}();return{connect:function(){var r=Object(l.a)(u.a.mark((function r(a){var c,o,s;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=a.token,o=a.cs_url,s=a.ws_url,r.abrupt("return",new Promise((function(r){var a=h.connect(s,{path:"/rtc",transports:["websocket"],forceNew:!1,reconnection:!1,autoConnect:!0});n(101)(h.Manager)(a),a.on("connect",(function(){a.on("*",(function(e){var n=Object(d.a)(e.data,2),r=n[0],a=n[1],c=Object(f.a)({type:r},a);t.forEach((function(e){return(0,e.callback)(c)}))}));var n={device_id:"666666666666666",device_type:"js",token:c};a.emit("session:login",{body:n}),a.on("session:success",(function(t){var n=t.body,a=n.id,i=n.name,u=n.user_id;e={session_id:a,user_name:i,user_id:u,token:c,cs_url:o,ws_url:s},r()}))}))})));case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),request:c,getSessionData:function(){return e},onEvent:function(e){var n=O();return t.push({id:n,callback:e}),n},onRequestStart:function(e){var t=O();return r.push({id:t,callback:e}),t},onRequestEnd:function(e){var t=O();return a.push({id:t,callback:e}),t}}}();var P=function(e){var t=function(e){var t=Object(a.useState)(null),n=Object(d.a)(t,2),r=n[0],c=n[1],o=function(e){c(e)};return Object(a.useEffect)((function(){e.onEvent(o),e.onRequestStart(o),e.onRequestEnd(o)})),r}(L),n=Object(a.useState)([]),c=Object(d.a)(n,2),o=c[0],s=c[1],i=Object(a.useState)([]),b=Object(d.a)(i,2),j=b[0],p=b[1],v=Object(a.useState)({}),h=Object(d.a)(v,2),O=(h[0],h[1],Object(a.useState)({audioSrcObject:null,peerConnection:null})),x=Object(d.a)(O,2),_=x[0],C=x[1];Object(a.useEffect)((function(){console.log(" ->->->-> useEffect init csClient"),function(){var t=Object(l.a)(u.a.mark((function t(){var n,r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(" ++++ initialize createCSClient"),n=e.loginData,r=n.token,a=n.cs_url,c=n.ws_url,L.connect({token:r,cs_url:a,ws_url:c});case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[e.loginData]),Object(a.useEffect)((function(){var e;(e=t)&&s((function(t){return[].concat(Object(m.a)(t),[e])}))}),[t]),Object(a.useEffect)((function(){if(console.log(" ->->->-> useEffect csClient Handler ",L),L){var e=function(e){var t=_.peerConnection.getRemoteStreams()[0];console.log("_setAudioSrcObject ",t),C((function(e){return console.log("setAudioState onTrack",Object(f.a)(Object(f.a)({},e),{},{audioSrcObject:t})),Object(f.a)(Object(f.a)({},e),{},{audioSrcObject:t})}))};L.onEvent(function(){var t=Object(l.a)(u.a.mark((function t(n){var r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"rtc:answer"===n.type&&(r=n.body.answer,a=new RTCSessionDescription({type:"answer",sdp:r}),_.peerConnection&&(_.peerConnection.ontrack=e,_.peerConnection.setRemoteDescription(a)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),L.onRequestEnd(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=t.request.url).includes("/users/")&&n.includes("/conversations")&&(r=t.response.data._embedded.conversations,p(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),[_]);var k=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("--- onEnableAudioInConversationSubmit",t),n=t.audio_conversation_id,r=n,e.next=6,q();case 6:return a=e.sent,console.log("setAudioState ",Object(f.a)(Object(f.a)({},_),{},{peerConnection:a})),C(Object(f.a)(Object(f.a)({},_),{},{peerConnection:a})),e.next=11,L.request({url:"/v0.3/users/".concat(L.getSessionData().user_id,"/conversations"),method:"get"});case 11:return c=e.sent,o=c.data._embedded.conversations.find((function(e){return e.id===r}))._embedded.member.id,e.next=15,L.request({url:"/v0.1/conversations/".concat(r,"/rtc"),method:"post",data:{from:o,body:{offer:a.localDescription}}});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log("onEnableAudioInConversationSubmit error: ",e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.conversation_name,r=t.conversation_display_name,e.next=3,L.request({url:"/v0.3/conversations",method:"post",data:{name:n,display_name:r}});case 3:return a=e.sent,e.next=6,L.request({url:"/v0.3/conversations/".concat(a.data.id,"/members"),method:"post",data:{state:"joined",user:{name:L.getSessionData().user_name},channel:{type:"app"}}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onJoinConversationSubmit ",t),n=t.conversation_join_id,e.next=4,L.request({url:"/v0.3/conversations/".concat(n,"/members"),method:"post",data:{state:"joined",user:{name:L.getSessionData().user_name},channel:{type:"app"}}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.request({url:"/v0.3/users/".concat(L.getSessionData().user_id,"/conversations"),method:"get"});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"Conversations Client Playground"}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Create Conversation and Join"}),Object(r.jsx)(g,{onSubmit:E}),Object(r.jsx)("h2",{children:"Join Conversation"}),Object(r.jsx)(y,{onSubmit:P}),Object(r.jsx)("h2",{children:"Get My Conversations"}),Object(r.jsx)("button",{onClick:R,children:"Get My Conversations"}),Object(r.jsx)("h2",{children:"Enable Audio In Conversations"}),Object(r.jsx)(S,{onSubmit:k}),Object(r.jsx)(w,{srcObject:_.audioSrcObject}),Object(r.jsxs)("div",{children:["Conversations (",j.length,")",j.length&&Object(r.jsx)("div",{children:j.map((function(e){var t=e.name,n=e.id,a=e._embedded.member;return Object(r.jsxs)("div",{children:[Object(r.jsxs)("b",{children:[t,": "]}),n," - ",a.state," - ",a.id]},n)}))})]}),Object(r.jsx)(D,{eventsHistory:o,onCleanHistoryClick:function(){return s((function(){return[]}))}})]})]})},R=(n(103),"http://localhost:5001");var T=function(e){var t=e.onSubmitLogin,n=e.onSubmitSubscribe;return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Login"}),Object(r.jsx)(v,{onSubmit:t}),Object(r.jsx)("h2",{children:"Subscribe"}),Object(r.jsx)(v,{onSubmit:n})]})},A=function(){var e=Object(a.useState)(null),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(null),s=Object(d.a)(o,2),i=(s[0],s[1]),b=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,e.next=3,j()({url:"".concat(R,"/api/login"),method:"post",data:{username:n}});case 3:r=e.sent,c(r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,e.next=3,j()({url:"".concat(R,"/api/subscribe"),method:"post",data:{username:n}});case 3:r=e.sent,i(r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){document.title="Conversation Service examples"})),Object(r.jsxs)("div",{children:[!n&&Object(r.jsx)(T,{onSubmitLogin:b,onSubmitSubscribe:p}),n&&Object(r.jsx)(P,{loginData:n})]})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,105)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};s.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(A,{})}),document.getElementById("root")),M()},53:function(e,t,n){},98:function(e,t){}},[[104,1,2]]]);
//# sourceMappingURL=main.00f4c060.chunk.js.map
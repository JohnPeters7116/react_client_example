{"version":3,"sources":["components/FormLogin.js","utils/csClient.js","components/FormCreateConversation.js","components/FormJoinConversation.js","components/FormEnableAudioInConversations.js","components/Audio.js","utils/createRtcAudioConnection.js","components/EventsHistory.js","containers/LoggedPage.js","App.js","reportWebVitals.js","index.js"],"names":["FormLogin","onSubmit","useForm","register","handleSubmit","errors","htmlFor","type","id","name","aria-invalid","ref","required","maxLength","role","socket_io","require","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","logger","console","log","error","FormCreateConversation","conversation_name","conversation_display_name","FormJoinConversation","conversation_join_id","value","FormEnableAudioInConversations","defaultValue","audio_conversation_id","Audio","srcObject","props","refAudio","useRef","useEffect","current","controls","autoPlay","waitFirstICEGatheringComplete","peerConnection","a","Promise","resolve","reject","onicegatheringstatechange","iceGatheringState","createRtcAudioConnection","navigator","mediaDevices","getUserMedia","video","audio","localStream","RTCPeerConnection","iceServers","urls","optional","addStream","createOffer","offerDescription","setLocalDescription","EventTitle","event","style","text","request","response","body","EventsHistory","eventsHistory","onCleanHistoryClick","onClick","map","evt","idx","padding","margin","backgroundColor","JSON","stringify","csClient","sessionData","onEventCallbacks","onRequestStartCallbacks","onRequestEndCallbacks","token","session_id","cs_url","headers","url","data","originating_session","forEach","callback","axios","axiosResponse","status","requestError","message","connect","ws_url","capi_client","path","transports","forceNew","reconnection","autoConnect","Manager","on","packet","loginData","emit","user_id","user_name","getSessionData","onEvent","push","onRequestStart","onRequestEnd","CSClient","LoggedPage","lastCSClientEvent","useState","setEvent","setLastEvent","clientEvent","useCSClientEvents","setEvents","myConversationsState","setMyConversationsState","audioSrcObject","audioState","setAudioState","initCSClient","onTrack","e","_setAudioSrcObject","getRemoteStreams","as","sdp","answer","remoteDescription","RTCSessionDescription","ontrack","setRemoteDescription","includes","conversations","_embedded","onEnableAudioInConversationSubmit","conversation_id","pc","method","userConvRes","member_id","find","member","from","offer","localDescription","onCreateConversationSubmit","convRes","onJoinConversationSubmit","getMyConversations","className","length","state","BACKEND_URL","NotLoggedPage","onSubmitLogin","onSubmitSubscribe","App","setLoginData","setsubscribeData","username","loginRes","document","title","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.00f4c060.chunk.js","sourcesContent":["import { useForm } from \"react-hook-form\";\n\nfunction FormLogin({ onSubmit }) {\n    const { register, handleSubmit, errors } = useForm();\n\n    return (\n        <form onSubmit={handleSubmit(onSubmit)}>\n            <label htmlFor=\"username\">User Name</label>\n\n            {/* use aria-invalid to indicate field contain error */}\n            <input\n                type=\"text\"\n                id=\"username\"\n                name=\"username\"\n                aria-invalid={errors.name ? \"true\" : \"false\"}\n                ref={register({ required: true, maxLength: 30 })}\n            />\n\n            {/* use role=\"alert\" to announce the error message */}\n            {errors.name && errors.name.type === \"required\" && (\n                <span role=\"alert\">This is required</span>\n            )}\n            {errors.name && errors.name.type === \"maxLength\" && (\n                <span role=\"alert\">Max length exceeded</span>\n            )}\n\n            <input type=\"submit\" />\n        </form>\n    )\n}\n\nexport default FormLogin","\nimport axios from 'axios';\n// import io from 'socket.io-client';\nconst socket_io = require('socket.io-client');\nfunction uuidv4() {\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n\n\nconst logger = {\n    info: (...args) => {\n        console.log(...args)\n    },\n    error: (...args) => {\n        console.error(...args)\n    }, \n}\n\n\nexport default function CSClient(){\n    let sessionData = {}\n    let onEventCallbacks = []\n    let onRequestStartCallbacks = []\n    let onRequestEndCallbacks = []\n\n    const onEvent = (callback) => {\n        const id = uuidv4()\n        onEventCallbacks.push({\n            id,\n            callback\n        }) \n        return id\n    }\n    const onRequestStart = (callback) => {\n        const id = uuidv4()\n        onRequestStartCallbacks.push({\n            id,\n            callback\n        })\n        return id\n    }\n\n    const onRequestEnd = (callback) => {\n        const id = uuidv4()\n        onRequestEndCallbacks.push({\n            id,\n            callback\n        })\n        return id\n    }\n\n    const request = async (request) => {\n        const { token, session_id, cs_url} = sessionData\n        try {\n            request.headers = {\n                'Authorization': `Bearer ${token}`,\n                // 'x-nexmo-sessionid': session_id\n            }\n            \n            request.url = `${cs_url}${request.url}`\n            if(request.data)\n                request.data = {\n                    originating_session: session_id,\n                    ...request.data\n                }\n\n            logger.info({ request }, \"CSClient request -> \")\n            onRequestStartCallbacks\n                .forEach(({ callback }) => callback({ request }))\n            const axiosResponse = await axios(request)\n            onRequestEndCallbacks\n                .forEach(({ callback }) => callback({\n                    request,\n                    response: {\n                        data: axiosResponse.data,\n                        status: axiosResponse.status,\n                        headers: axiosResponse.headers\n                    }\n                }))\n\n            logger.info({ request, data: axiosResponse.data, status: axiosResponse.status }, \"CSClient reponse <-\")\n            return axiosResponse\n        } catch (err) {\n            const requestError = {\n                request: request\n            }\n            if (err.response) {\n                requestError.response = {\n                    data: err.response.data,\n                    status: err.response.status,\n                    headers: err.response.headers,\n                }\n            }\n            if (err.message) {\n                requestError.message = err.message\n            }\n\n            logger.error({ ...requestError }, \"CSClient error <-\")\n            onRequestEndCallbacks\n                .forEach(({ callback }) => callback(requestError))\n\n            throw err;\n        }\n    }\n    // const onEvent = () => \n    const getSessionData = () => sessionData\n\n    const connect = async ({ token, cs_url, ws_url }) =>  new Promise(resolve => {\n\n        const capi_client = socket_io.connect(ws_url, {\n            path: \"/rtc\",\n            transports: ['websocket'],\n            forceNew: false,\n            reconnection: false,\n            autoConnect: true,\n        });\n\n        \n        require('socketio-wildcard')(socket_io.Manager)(capi_client)\n\n        capi_client.on('connect', function () {\n\n            capi_client.on('*', function (packet) {\n                const [type, body] = packet.data;\n                const event = { type, ...body };\n                // onEventCallback(event)\n                onEventCallbacks\n                    .forEach(({callback}) => callback(event) )\n\n            })\n            const loginData = {\n                \"device_id\": \"666666666666666\", // TODO: use https://github.com/Valve/fingerprintjs2\n                \"device_type\": \"js\",\n                token\n            }\n\n            capi_client.emit(\"session:login\", { body: loginData} )\n\n            capi_client.on(\"session:success\", (event) => {\n                const {id, name, user_id} = event.body\n                sessionData = {\n                    session_id: id,\n                    user_name: name,\n                    user_id: user_id,\n                    token,\n                    cs_url, \n                    ws_url\n\n                }\n                resolve()\n\n            })\n        })\n\n\n        \n    });\n\n    \n    return {\n        connect,\n        request,\n        getSessionData,\n        onEvent,\n        onRequestStart,\n        onRequestEnd\n    }\n\n}","// import React, { useState, useEffect, useRef } from 'react';\nimport { useForm } from \"react-hook-form\";\n\nfunction FormCreateConversation({ onSubmit }) {\n    const { register, handleSubmit, errors } = useForm();\n\n    return (\n        <form name=\"CreateConversation\" id=\"CreateConversation\" onSubmit={handleSubmit(onSubmit)}>\n            <label htmlFor=\"conversation_name\">Name</label>\n\n            {/* use aria-invalid to indicate field contain error */}\n            <input\n                type=\"text\"\n                id=\"conversation_name\"\n                name=\"conversation_name\"\n                aria-invalid={errors.conversation_name ? \"true\" : \"false\"}\n                ref={register({ required: true, maxLength: 30 })}\n            />\n            {errors.conversation_name && errors.conversation_name.type === \"required\" && (\n                <span role=\"alert\">This is required</span>\n            )}\n            {errors.conversation_name && errors.conversation_name.type === \"maxLength\" && (\n                <span role=\"alert\">Max length exceeded</span>\n            )}\n            <br />\n            <label htmlFor=\"conversation_display_name\">Display Name</label>\n            <input\n                type=\"text\"\n                id=\"conversation_display_name\"\n                name=\"conversation_display_name\"\n                aria-invalid={errors.conversation_display_name ? \"true\" : \"false\"}\n                ref={register({ required: true, maxLength: 30 })}\n            />\n\n            {/* use role=\"alert\" to announce the error message */}\n            {errors.conversation_display_name && errors.conversation_display_name.type === \"required\" && (\n                <span role=\"alert\">This is required</span>\n            )}\n            {errors.conversation_display_name && errors.conversation_display_name.type === \"maxLength\" && (\n                <span role=\"alert\">Max length exceeded</span>\n            )}\n            <br />\n            <input type=\"submit\" />\n        </form>\n    )\n}\n\nexport default FormCreateConversation","// import React, { useState, useEffect, useRef } from 'react';\nimport { useForm } from \"react-hook-form\";\n\nfunction FormJoinConversation({ onSubmit }) {\n    const { register, handleSubmit, errors } = useForm();\n\n    return (\n        <form name=\"joinConversation\" id=\"joinConversation\" onSubmit={handleSubmit(onSubmit)}>\n            <label htmlFor=\"conversation_join_id\">Conversation ID:</label>\n\n            <input\n                type=\"text\"\n                id=\"conversation_join_id\"\n                name=\"conversation_join_id\"\n                aria-invalid={errors.conversation_join_id ? \"true\" : \"false\"}\n                ref={register({ required: true, maxLength: 40 })}\n            />\n\n            {errors.conversation_join_id && errors.conversation_join_id.type === \"required\" && (\n                <span role=\"alert\">This is required</span>\n            )}\n            <br />\n\n            <input type=\"submit\" value=\"Join Conversation\" />\n        </form>\n    )\n}\n\nexport default FormJoinConversation","\nimport { useForm } from \"react-hook-form\";\n\nfunction FormEnableAudioInConversations({ onSubmit }) {\n    const { register, handleSubmit, errors } = useForm();\n\n    return (\n        <form onSubmit={handleSubmit(onSubmit)}>\n            <label htmlFor=\"audio_conversation_id\">Conversations Id </label>\n\n            {/* use aria-invalid to indicate field contain error */}\n            <input\n                type=\"text\"\n                id=\"audio_conversation_id\"\n                name=\"audio_conversation_id\"\n                aria-invalid={errors.name ? \"true\" : \"false\"}\n                defaultValue=\"CON-71ed48a1-4983-4557-a911-561fcb380d2f\"\n                ref={register({ required: true, maxLength: 40, })}\n            />\n\n            {/* use role=\"alert\" to announce the error message */}\n            {errors.audio_conversation_id && errors.audio_conversation_id.type === \"required\" && (\n                <span role=\"alert\">This is required</span>\n            )}\n            {errors.audio_conversation_id && errors.audio_conversation_id.type === \"maxLength\" && (\n                <span role=\"alert\">Max length exceeded</span>\n            )}\n\n            <input type=\"submit\" />\n        </form>\n    )\n}\n\nexport default FormEnableAudioInConversations;","import React, { useRef, useEffect } from 'react';\n\nfunction Audio({ srcObject, ...props }) {\n    const refAudio = useRef(null)\n\n    useEffect(() => {\n        if (!refAudio.current) return\n        refAudio.current.srcObject = srcObject\n    }, [srcObject])\n\n    return <audio ref={refAudio} {...props} controls autoPlay />\n}\n\nexport default Audio","\nconst waitFirstICEGatheringComplete = async (peerConnection) => {\n    return new Promise((resolve, reject) => {\n        peerConnection.onicegatheringstatechange = () => {\n            console.log(\"onicegatheringstatechange \", peerConnection.iceGatheringState);\n            if (peerConnection.iceGatheringState === 'complete') {\n                resolve()\n            }\n        }\n    })\n\n}\n\n\nconst createRtcAudioConnection = async() => {\n    const localStream = await navigator.mediaDevices\n        .getUserMedia({\n            video: false,\n            audio: true,\n        })\n    \n    const peerConnection = new RTCPeerConnection(\n        {\n            iceServers: [\n                { urls: \"stun:stun.l.google.com:19302\", }\n            ],\n            'iceTransportPolicy': 'all',\n            'bundlePolicy': 'balanced',\n            'rtcpMuxPolicy': 'require',\n            'iceCandidatePoolSize': '0',\n        }, \n        {\n            optional: [{\n                'DtlsSrtpKeyAgreement': 'true',\n            }],\n        }\n    );    \n\n    peerConnection.addStream(localStream)\n    \n    const offerDescription = await peerConnection.createOffer()\n    \n    peerConnection.setLocalDescription(offerDescription)\n    \n    await waitFirstICEGatheringComplete(peerConnection)\n\n    return peerConnection\n\n}\n\n\nfunction _createRtcAudioConnection(){\n    return navigator.mediaDevices\n        .getUserMedia({\n            video: false,\n            audio: true,\n        })\n        .then((localStream) => {\n            console.log(\"RTCPeerConnection init\", localStream)\n            const iceServers = [\n                {\n                    urls: \"stun:stun.l.google.com:19302\",\n                    // urls: 'turn:138.68.169.35:3478?transport=tcp',\n                    // credential: 'bar',\n                    // username: 'foo2',\n                },\n            ]\n\n            var pc = new RTCPeerConnection({\n                iceServers,\n                'iceTransportPolicy': 'all',\n                'bundlePolicy': 'balanced',\n                'rtcpMuxPolicy': 'require',\n                'iceCandidatePoolSize': '0',\n            }, {\n                optional: [{\n                    'DtlsSrtpKeyAgreement': 'true',\n                }],\n            });\n\n            pc.addStream(localStream)\n\n            return pc\n        })\n        .then((pc) => {\n            console.log(\"create offer init\")\n            return pc.createOffer()\n                .then(offerDescription => pc.setLocalDescription(offerDescription))\n                .then(() => pc)\n        })\n        .then((pc) => {\n            console.log(\"onicegatheringstatechange init\")\n            return new Promise((resolve, reject) => {\n                pc.onicegatheringstatechange = () => {\n                    console.log(\"onicegatheringstatechange \", pc.iceGatheringState);\n                    if (pc.iceGatheringState === 'complete') {\n                        resolve(pc)\n                    }\n                }\n            })\n        })\n}\n\nexport default createRtcAudioConnection","\nconst EventsHistory = ({ eventsHistory, onCleanHistoryClick }) => {\n    return (\n        <div>\n            <h2>History</h2>\n            <div>\n                <button onClick={onCleanHistoryClick} >Clean History</button>\n            </div>\n            {eventsHistory.map((evt, idx) => {\n                return (\n                    <div key={idx}  >\n                        <EventTitle event={evt} style={{ padding: \"5px\", margin: \"5px\" }} />\n                        <pre style={{ padding: \"5px\", margin: \"5px\", backgroundColor: \"#ddd\" }} >{JSON.stringify(evt, ' ', ' ')}</pre>\n                    </div>\n                )\n            })}\n        </div>\n    )\n}\n\n\nconst EventTitle = ({ event, style }) => {\n    let text = 'unknown'\n    if (event.request && event.response) {\n        text = '<- http response'\n    } else if (event.request && !event.response) {\n        text = '-> http request'\n    } else if (event.type && event.body) {\n        text = '<- ws event'\n    }\n\n\n    return (<h3 style={style} >{text}</h3>)\n}\n\n\n\nexport default EventsHistory","import React, { useState, useEffect } from 'react';\n\nimport CSClient from '../utils/csClient'\nimport FormCreateConversation from '../components/FormCreateConversation'\nimport FormJoinConversation from '../components/FormJoinConversation'\nimport FormEnableAudioInConversations from '../components/FormEnableAudioInConversations'\nimport Audio from '../components/Audio'\nimport createRtcAudioConnection from '../utils/createRtcAudioConnection'\nimport EventsHistory from '../components/EventsHistory'\n\n\n\nconst csClient = CSClient()\n\nfunction useCSClientEvents(csClient) {\n\n    const [event, setEvent] = useState(null)\n\n    const setLastEvent = (clientEvent) => {\n        setEvent(clientEvent)\n    }\n\n    useEffect(() => {\n        csClient.onEvent(setLastEvent)\n        csClient.onRequestStart(setLastEvent)\n        csClient.onRequestEnd(setLastEvent)\n    })\n\n    return event\n}\n\nfunction LoggedPage(props) {\n\n    // const [csClient, setCsClient] = useState(null)\n\n    const lastCSClientEvent = useCSClientEvents(csClient)\n    const [eventsHistory, setEvents] = useState([])\n    const [myConversationsState, setMyConversationsState] = useState([])\n    const [conversationsEvents, setConversationsEvents] = useState({})\n\n    // useCSClientEvents\n    const [audioState, setAudioState] = useState({\n        audioSrcObject: null,\n        peerConnection: null\n    })\n\n\n    //init cs client\n    useEffect(() => {\n        console.log(` ->->->-> useEffect init csClient`)\n\n        const initCSClient = async () => {\n            console.log(` ++++ initialize createCSClient`)\n            const { token, cs_url, ws_url } = props.loginData\n\n            csClient.connect({\n                token, cs_url, ws_url\n            });\n\n        }\n\n        initCSClient()\n\n\n    }, [props.loginData])\n\n    useEffect(() => {\n\n        const appendHistory = (clientEvent) => {\n            if (clientEvent)\n                setEvents(eventsHistory => [...eventsHistory, clientEvent])\n        }\n\n        appendHistory(lastCSClientEvent)\n\n    }, [lastCSClientEvent])\n\n\n    useEffect(() => {\n        console.log(` ->->->-> useEffect csClient Handler `, csClient);\n        if (!csClient)\n            return;\n\n        const onTrack = (e) => {\n            const _setAudioSrcObject = audioState.peerConnection.getRemoteStreams()[0]\n            console.log(`_setAudioSrcObject `, _setAudioSrcObject)\n\n            setAudioState(as => {\n                console.log(`setAudioState onTrack`, {\n                    ...as,\n                    audioSrcObject: _setAudioSrcObject\n                })\n                return {\n                    ...as,\n                    audioSrcObject: _setAudioSrcObject\n                }\n            })\n        }\n\n        csClient.onEvent(async (evt) => {\n            if (evt.type === 'rtc:answer') {\n                const sdp = evt.body.answer\n                const remoteDescription = new RTCSessionDescription({\n                    type: 'answer',\n                    sdp,\n                })\n                if (audioState.peerConnection) {\n                    audioState.peerConnection.ontrack = onTrack\n                    audioState.peerConnection.setRemoteDescription(remoteDescription)\n                }\n            }\n        })\n\n        csClient.onRequestEnd(async (event) => {\n            const url = event.request.url\n            if (url.includes(\"/users/\") && url.includes(\"/conversations\") ) {\n                const conversations = event.response.data._embedded.conversations\n                setMyConversationsState(conversations)\n            }\n\n            \n        })\n\n    }, [audioState])\n\n    const onEnableAudioInConversationSubmit = async (data) => {\n        // const { conversation_id } = data\n        try {\n            console.log(`--- onEnableAudioInConversationSubmit`, data)\n            const { audio_conversation_id } = data\n            const conversation_id = audio_conversation_id\n            const pc = await createRtcAudioConnection()\n\n            console.log(`setAudioState `, { ...audioState, peerConnection: pc })\n            setAudioState({ ...audioState, peerConnection: pc })\n\n            // peerConnection = pc\n            const userConvRes = await csClient.request({\n                url: `/v0.3/users/${csClient.getSessionData().user_id}/conversations`,\n                method: \"get\"\n            })\n\n            const member_id = userConvRes.data._embedded.conversations.find(({ id }) => id === conversation_id)._embedded.member.id\n\n            await csClient.request({\n                url: `/v0.1/conversations/${conversation_id}/rtc`,\n                method: \"post\",\n                data: {\n                    from: member_id,\n                    body: {\n                        offer: pc.localDescription,\n                    }\n                }\n            })\n\n        } catch (e) {\n            console.log(`onEnableAudioInConversationSubmit error: `, e)\n        }\n\n    }\n\n    const onCreateConversationSubmit = async (data) => {\n        const { conversation_name, conversation_display_name } = data\n        const convRes = await csClient.request({\n            url: `/v0.3/conversations`,\n            method: \"post\",\n            data: {\n                \"name\": conversation_name,\n                \"display_name\": conversation_display_name\n            }\n        })\n\n        await csClient.request({\n            url: `/v0.3/conversations/${convRes.data.id}/members`,\n            method: \"post\",\n            data: {\n                \"state\": \"joined\",\n                \"user\": {\n                    name: csClient.getSessionData().user_name,\n                },\n                \"channel\": {\n                    \"type\": \"app\"\n                }\n            }\n        })\n\n    }\n\n    const onJoinConversationSubmit = async (data) => {\n        console.log('onJoinConversationSubmit ', data)\n        const { conversation_join_id} = data\n        await csClient.request({\n            url: `/v0.3/conversations/${conversation_join_id}/members`,\n            method: \"post\",\n            data: {\n                \"state\": \"joined\",\n                \"user\": {\n                    name: csClient.getSessionData().user_name,\n                },\n                \"channel\": {\n                    \"type\": \"app\"\n                }\n            }\n        })\n\n    }\n\n    const getMyConversations = async () => {\n        await csClient.request({\n            url: `/v0.3/users/${csClient.getSessionData().user_id}/conversations`,\n            method: \"get\"\n        })\n    }\n\n    \n    return (\n        <div className=\"App\">\n            <h1>Conversations Client Playground</h1>\n            <div>\n                <h2>Create Conversation and Join</h2>\n                <FormCreateConversation onSubmit={onCreateConversationSubmit} />\n                <h2>Join Conversation</h2>\n                <FormJoinConversation onSubmit={onJoinConversationSubmit} />\n                <h2>Get My Conversations</h2>\n                <button onClick={getMyConversations} >Get My Conversations</button>\n                <h2>Enable Audio In Conversations</h2>\n                <FormEnableAudioInConversations onSubmit={onEnableAudioInConversationSubmit} />\n                <Audio srcObject={audioState.audioSrcObject} />\n                <div>\n                    Conversations ({myConversationsState.length})\n                    {myConversationsState.length && <div>\n                        {myConversationsState.map(({ name, id, _embedded}) => {\n                            const { member } = _embedded\n                            return (<div key={id}>\n                                <b>{name}: </b>{id} - {member.state} - {member.id}\n                            </div>)\n                        })}\n                        \n\n                    </div>\n\n                    }\n                </div>\n\n                <EventsHistory\n                    eventsHistory={eventsHistory}\n                    onCleanHistoryClick={() => setEvents(() => [])}\n                />\n            </div>\n\n        </div>\n    );\n}\n\nexport default LoggedPage","import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\nimport FormLogin from \"./components/FormLogin\";\n\nimport LoggedPage from \"./containers/LoggedPage.js\";\n\nimport \"./App.css\";\n\nconst BACKEND_URL = `http://localhost:5001`;\n\nfunction App() {\n  const [loginData, setLoginData] = useState(null);\n  const [subscribeData, setsubscribeData] = useState(null);\n\n  const onSubmitLogin = async ({ username }) => {\n    const loginRes = await axios({\n      url: `${BACKEND_URL}/api/login`,\n      method: \"post\",\n      data: {\n        username: username,\n      },\n    });\n    setLoginData(loginRes.data);\n  };\n\n  const onSubmitSubscribe = async ({ username }) => {\n    const loginRes = await axios({\n      url: `${BACKEND_URL}/api/subscribe`,\n      method: \"post\",\n      data: {\n        username: username,\n      },\n    });\n    setsubscribeData(loginRes.data);\n  };\n\n  useEffect(() => {\n    document.title = \"Conversation Service examples\";\n  });\n\n  return (\n    <div>\n      {!loginData && (\n        <NotLoggedPage\n          onSubmitLogin={onSubmitLogin}\n          onSubmitSubscribe={onSubmitSubscribe}\n        />\n      )}\n      {loginData && <LoggedPage loginData={loginData} />}\n    </div>\n  );\n}\n\nconst NotLoggedPage = ({ onSubmitLogin, onSubmitSubscribe }) => {\n  return (\n    <div>\n      <h2>Login</h2>\n      <FormLogin onSubmit={onSubmitLogin} />\n      <h2>Subscribe</h2>\n      <FormLogin onSubmit={onSubmitSubscribe} />\n    </div>\n  );\n};\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}